---
repository: https://github.com/floccusaddon/floccus.git
updates: releases
notes:
  - 'FIXME: embedded sentry commit hash mismatch for v5.1.1 & v5.1.2'
versions:
  - tag: v5.0.8
    apks:
      - apk_pattern: floccus-build-.*\.apk
        apk_url: https://github.com/floccusaddon/floccus/releases/download/$$TAG$$/floccus-build-$$TAG$$.apk
        build:
          - wget -q -O /tmp/nodejs-lts.zip -- https://nodejs.org/dist/v20.11.1/node-v20.11.1-linux-x64.tar.xz
          - sha256sum -c <<< 'd8dab549b09672b03356aa2257699f3de3b58c96e74eb26a8b495fbdc9cf6fbe  /tmp/nodejs-lts.zip'
          - tar xf /tmp/nodejs-lts.zip -C /opt
          - export PATH="${PATH}:/opt/node-v20.11.1-linux-x64/bin"
          - npm install
          - npx gulp
          - cp dist/icons/logo_64.png android/app/src/main/res/drawable/
          - npx cap sync
          - cd android
          - ./gradlew assembleRelease
          - mv app/build/outputs/apk/release/app-release-unsigned.apk /outputs/unsigned.apk
        build_home_dir: /build
        build_repo_dir: /build/repo
        build_user: build
        provisioning:
          android_home: /opt/sdk
          build_tools:
          cmake:
          cmdline_tools:
            version: '12.0'
            url: https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
            sha256: 2d2d50857e4eb553af5a6dc3ad507a17adf43d115264b1afc116f95c92e5e258
          extra_packages:
            - xz-utils
          image: debian:bookworm-slim
          jdk: openjdk-17-jdk-headless
          ndk:
          platform:
          platform_tools:
          tools:
          verify_gradle_wrapper: true
  - tag: v5.0.10
    apks:
      - apk_pattern: floccus-build-.*\.apk
        apk_url: https://github.com/floccusaddon/floccus/releases/download/$$TAG$$/floccus-build-$$TAG$$.apk
        build:
          - wget -q -O /tmp/nodejs-lts.zip -- https://nodejs.org/dist/v20.11.1/node-v20.11.1-linux-x64.tar.xz
          - sha256sum -c <<< 'd8dab549b09672b03356aa2257699f3de3b58c96e74eb26a8b495fbdc9cf6fbe  /tmp/nodejs-lts.zip'
          - tar xf /tmp/nodejs-lts.zip -C /opt
          - export PATH="${PATH}:/opt/node-v20.11.1-linux-x64/bin"
          - npm install
          - npx gulp
          - npx cap sync
          - cd android
          - ./gradlew assembleRelease
          - mv app/build/outputs/apk/release/app-release-unsigned.apk /outputs/unsigned.apk
        build_home_dir: /build
        build_repo_dir: /build/repo
        build_user: build
        provisioning:
          android_home: /opt/sdk
          build_tools:
          cmake:
          cmdline_tools:
            version: '12.0'
            url: https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
            sha256: 2d2d50857e4eb553af5a6dc3ad507a17adf43d115264b1afc116f95c92e5e258
          extra_packages:
            - xz-utils
          image: debian:bookworm-slim
          jdk: openjdk-17-jdk-headless
          ndk:
          platform:
          platform_tools:
          tools:
          verify_gradle_wrapper: true
  - tag: v5.0.11
    apks:
      - apk_pattern: floccus-build-.*\.apk
        apk_url: https://github.com/floccusaddon/floccus/releases/download/$$TAG$$/floccus-build-$$TAG$$.apk
        build:
          - wget -q -O /tmp/nodejs-lts.zip -- https://nodejs.org/dist/v20.11.1/node-v20.11.1-linux-x64.tar.xz
          - sha256sum -c <<< 'd8dab549b09672b03356aa2257699f3de3b58c96e74eb26a8b495fbdc9cf6fbe  /tmp/nodejs-lts.zip'
          - tar xf /tmp/nodejs-lts.zip -C /opt
          - export PATH="${PATH}:/opt/node-v20.11.1-linux-x64/bin"
          - npm install
          - npx gulp
          - npx cap sync
          - cd android
          - ./gradlew assembleRelease
          - mv app/build/outputs/apk/release/app-release-unsigned.apk /outputs/unsigned.apk
        build_home_dir: /build
        build_repo_dir: /build/repo
        build_user: build
        provisioning:
          android_home: /opt/sdk
          build_tools:
          cmake:
          cmdline_tools:
            version: '12.0'
            url: https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
            sha256: 2d2d50857e4eb553af5a6dc3ad507a17adf43d115264b1afc116f95c92e5e258
          extra_packages:
            - xz-utils
          image: debian:bookworm-slim
          jdk: openjdk-17-jdk-headless
          ndk:
          platform:
          platform_tools:
          tools:
          verify_gradle_wrapper: true
  - tag: v5.0.12
    apks:
      - apk_pattern: floccus-build-.*\.apk
        apk_url: https://github.com/floccusaddon/floccus/releases/download/$$TAG$$/floccus-build-$$TAG$$.apk
        build:
          - sed -r '/import browser/d' -i src/ui/views/Update.vue
          - wget -q -O /tmp/nodejs-lts.zip -- https://nodejs.org/dist/v20.12.2/node-v20.12.2-linux-x64.tar.xz
          - sha256sum -c <<< '595272130310cbe12301430756f23d153f7ab95d00174c02adc11a2e3703d183  /tmp/nodejs-lts.zip'
          - tar xf /tmp/nodejs-lts.zip -C /opt
          - export PATH="${PATH}:/opt/node-v20.12.2-linux-x64/bin"
          - npm install
          - npx gulp
          - npx cap sync
          - cd android
          - ./gradlew assembleRelease
          - mv app/build/outputs/apk/release/app-release-unsigned.apk /outputs/unsigned.apk
        build_home_dir: /build
        build_repo_dir: /build/repo
        build_user: build
        provisioning:
          android_home: /opt/sdk
          build_tools:
          cmake:
          cmdline_tools:
            version: '12.0'
            url: https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
            sha256: 2d2d50857e4eb553af5a6dc3ad507a17adf43d115264b1afc116f95c92e5e258
          extra_packages:
            - xz-utils
          image: debian:bookworm-slim
          jdk: openjdk-17-jdk-headless
          ndk:
          platform:
          platform_tools:
          tools:
          verify_gradle_wrapper: true
  - tag: v5.1.0
    apks:
      - apk_pattern: floccus-build-.*\.apk
        apk_url: https://github.com/floccusaddon/floccus/releases/download/$$TAG$$/floccus-build-$$TAG$$.apk
        build:
          - wget -q -O /tmp/nodejs-lts.zip -- https://nodejs.org/dist/v20.12.2/node-v20.12.2-linux-x64.tar.xz
          - sha256sum -c <<< '595272130310cbe12301430756f23d153f7ab95d00174c02adc11a2e3703d183  /tmp/nodejs-lts.zip'
          - tar xf /tmp/nodejs-lts.zip -C /opt
          - export PATH="${PATH}:/opt/node-v20.12.2-linux-x64/bin"
          - npm install
          - npx gulp
          - npx cap sync
          - cd android
          - ./gradlew assembleRelease
          - mv app/build/outputs/apk/release/app-release-unsigned.apk /outputs/unsigned.apk
        build_home_dir: /build
        build_repo_dir: /build/repo
        build_user: build
        provisioning:
          android_home: /opt/sdk
          build_tools:
          cmake:
          cmdline_tools:
            version: '12.0'
            url: https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
            sha256: 2d2d50857e4eb553af5a6dc3ad507a17adf43d115264b1afc116f95c92e5e258
          extra_packages:
            - xz-utils
          image: debian:bookworm-slim
          jdk: openjdk-17-jdk-headless
          ndk:
          platform:
          platform_tools:
          tools:
          verify_gradle_wrapper: true
  - tag: v5.1.1
    apks:
      - apk_pattern: floccus-build-.*\.apk
        apk_url: https://github.com/floccusaddon/floccus/releases/download/$$TAG$$/floccus-build-$$TAG$$.apk
        build:
          - git reset --soft 968f06125414815853505e0d411ebc07f225e13d
          - wget -q -O /tmp/nodejs-lts.zip -- https://nodejs.org/dist/v20.13.1/node-v20.13.1-linux-x64.tar.xz
          - sha256sum -c <<< 'efc0f295dd878e510ab12ea36bbadc3db03c687ab30c07e86c7cdba7eed879a9  /tmp/nodejs-lts.zip'
          - tar xf /tmp/nodejs-lts.zip -C /opt
          - export PATH="${PATH}:/opt/node-v20.13.1-linux-x64/bin"
          - npm install
          - npx gulp
          - npx cap sync
          - cd android
          - ./gradlew assembleRelease
          - mv app/build/outputs/apk/release/app-release-unsigned.apk /outputs/unsigned.apk
        build_home_dir: /build
        build_repo_dir: /build/repo
        build_user: build
        provisioning:
          android_home: /opt/sdk
          build_tools:
          cmake:
          cmdline_tools:
            version: '12.0'
            url: https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
            sha256: 2d2d50857e4eb553af5a6dc3ad507a17adf43d115264b1afc116f95c92e5e258
          extra_packages:
            - xz-utils
          image: debian:bookworm-slim
          jdk: openjdk-17-jdk-headless
          ndk:
          platform:
          platform_tools:
          tools:
          verify_gradle_wrapper: true
  - tag: v5.1.2
    apks:
      - apk_pattern: floccus-build-.*\.apk
        apk_url: https://github.com/floccusaddon/floccus/releases/download/$$TAG$$/floccus-build-$$TAG$$.apk
        build:
          - export SENTRY_RELEASE=ad1cd58a9ac6fd6db7c56f9633b790f3f51da4bb
          - wget -q -O /tmp/nodejs-lts.zip -- https://nodejs.org/dist/v20.13.1/node-v20.13.1-linux-x64.tar.xz
          - sha256sum -c <<< 'efc0f295dd878e510ab12ea36bbadc3db03c687ab30c07e86c7cdba7eed879a9  /tmp/nodejs-lts.zip'
          - tar xf /tmp/nodejs-lts.zip -C /opt
          - export PATH="${PATH}:/opt/node-v20.13.1-linux-x64/bin"
          - npm install
          - npx gulp
          - npx cap sync
          - cd android
          - ./gradlew assembleRelease
          - mv app/build/outputs/apk/release/app-release-unsigned.apk /outputs/unsigned.apk
        build_home_dir: /build
        build_repo_dir: /build/repo
        build_user: build
        provisioning:
          android_home: /opt/sdk
          build_tools:
          cmake:
          cmdline_tools:
            version: '12.0'
            url: https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
            sha256: 2d2d50857e4eb553af5a6dc3ad507a17adf43d115264b1afc116f95c92e5e258
          extra_packages:
            - xz-utils
          image: debian:bookworm-slim
          jdk: openjdk-17-jdk-headless
          ndk:
          platform:
          platform_tools:
          tools:
          verify_gradle_wrapper: true
  - tag: v5.1.3
    apks:
      - apk_pattern: floccus-build-.*\.apk
        apk_url: https://github.com/floccusaddon/floccus/releases/download/$$TAG$$/floccus-build-$$TAG$$.apk
        build:
          - export SENTRY_RELEASE=ad1cd58a9ac6fd6db7c56f9633b790f3f51da4bb
          - wget -q -O /tmp/nodejs-lts.zip -- https://nodejs.org/dist/v20.13.1/node-v20.13.1-linux-x64.tar.xz
          - sha256sum -c <<< 'efc0f295dd878e510ab12ea36bbadc3db03c687ab30c07e86c7cdba7eed879a9  /tmp/nodejs-lts.zip'
          - tar xf /tmp/nodejs-lts.zip -C /opt
          - export PATH="${PATH}:/opt/node-v20.13.1-linux-x64/bin"
          - npm install
          - npx gulp
          - npx cap sync
          - cd android
          - ./gradlew assembleRelease
          - mv app/build/outputs/apk/release/app-release-unsigned.apk /outputs/unsigned.apk
        build_home_dir: /build
        build_repo_dir: /build/repo
        build_user: build
        provisioning:
          android_home: /opt/sdk
          build_tools:
          cmake:
          cmdline_tools:
            version: '12.0'
            url: https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
            sha256: 2d2d50857e4eb553af5a6dc3ad507a17adf43d115264b1afc116f95c92e5e258
          extra_packages:
            - xz-utils
          image: debian:bookworm-slim
          jdk: openjdk-17-jdk-headless
          ndk:
          platform:
          platform_tools:
          tools:
          verify_gradle_wrapper: true
